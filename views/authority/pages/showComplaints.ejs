<%- include('../components/header.ejs') %>

<section class="hero-wrap hero-wrap-2" style="background-image: url('/images/bg_2.jpg');" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
        <div class="row no-gutters slider-text align-items-center justify-content-center">
            <div class="col-md-9 ftco-animate text-center">
                <p class="breadcrumbs mb-2"><span class="mr-2"><a href="/authority/dashboard">Home <i class="fa fa-chevron-right"></i></a></span> <span>Complaints <i class="fa fa-chevron-right"></i></span></p>
                <h1 class="mb-0 bread">Complaints</h1>
            </div>
        </div>
    </div>
</section>

<section class="ftco-section bg-light">
    <div class="container">
        <div class="row">
            <div class="col-md-12 mb-5">
                <div style="display: flex; flex-wrap: nowrap; align-items: center; justify-content: center; gap: 10px;">
                    <button type="button" id="showNewComplaint" class="btn btn-primary">New Complaints</button>
                    <button type="button" id="showAcceptedComplaint" class="btn btn-primary">Accepted Complaints</button>
                </div>
            </div>
        </div>
        <div id="newComplaintSection">
            <div class="row">
                <div class="col-md-12 mb-5">
                    <center><h4>New Complaints</h4></center>
                </div>
            </div>
            <div class="row d-flex" id="dataSection">
                <%
                    newComplaints.forEach((newComplaint)=>{
                        const createdAtDate = new Date(newComplaint.createdAt);
                        const formattedDate = createdAtDate.toDateString();
                %>
                    <div class="col-md-4 d-flex ftco-animate">
                        <div class="blog-entry align-self-stretch">
                            <a href="/authority/request-detail/<%= newComplaint._id %>" class="block-20 rounded" style="background-image: url('<%= newComplaint.problemImage.url %>');">
                            </a>
                            <div class="text p-4 text-center">
                                <h3 class="heading"><a href="/authority/request-detail/<%= newComplaint._id %>"><%= newComplaint.title %></a></h3>
                                <div class="meta mb-2">
                                    <div><a href="/authority/request-detail/<%= newComplaint._id %>"><%= formattedDate  %></a></div>
                                </div>
                                <p><%= newComplaint.description.substring(0,80) %>...</p>
                                <button type="button" class="btn btn-primary" onclick="window.location.pathname = '/authority/request-detail/<%= newComplaint._id %>'">More Info</button>
                            </div>
                        </div>
                    </div>
                <%
                    })
                %>
            </div>
        </div>
        <div id="acceptedComplaintSection">
            <div class="row">
                <div class="col-md-12 mb-5">
                    <center><h4>Accepted Complaints</h4></center>
                </div>
            </div>
            <div class="row d-flex" id="dataSection">
                <%
                    acceptedComplaints.forEach((acceptedComplaint)=>{
                        const createdAtDate = new Date(acceptedComplaint.createdAt);
                        const formattedDate = createdAtDate.toDateString();
                %>
                    <div class="col-md-4 d-flex ftco-animate">
                        <div class="blog-entry align-self-stretch">
                            <a href="/authority/request-detail/<%= acceptedComplaint._id %>" class="block-20 rounded" style="background-image: url('<%= acceptedComplaint.problemImage.url %>');">
                            </a>
                            <div class="text p-4 text-center">
                                <h3 class="heading"><a href="/authority/request-detail/<%= acceptedComplaint._id %>"><%= acceptedComplaint.title %></a></h3>
                                <div class="meta mb-2">
                                    <div><a href="/authority/request-detail/<%= acceptedComplaint._id %>"><%= formattedDate  %></a></div>
                                </div>
                                <p><%= acceptedComplaint.description.substring(0,80) %>...</p>
                                <button type="button" class="btn btn-primary" onclick="window.location.pathname = '/authority/request-detail/<%= acceptedComplaint._id %>'">More Info</button>
                            </div>
                        </div>
                    </div>
                <%
                    })
                %>
            </div>
        </div>
    </div>
</section>

<script>
    $(document).ready(function() {
        $('#acceptedComplaintSection').hide()
    });

    $('#showNewComplaint').click(function(){
        $('#newComplaintSection').show()
        $('#acceptedComplaintSection').hide()
    })
    $('#showAcceptedComplaint').click(function(){
        $('#newComplaintSection').hide()
        $('#acceptedComplaintSection').show()
    })
</script>

<%- include('../components/footer.ejs') %>